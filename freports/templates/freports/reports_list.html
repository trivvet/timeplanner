{% extends "freports/base.html" %}

{% block title %}
<!-- Navbar with select lists -->
<nav class="navbar navbar-expand-xl navbar-dark" style="background-color: #69a9ee;">
    <a class="navbar-brand" href="{% url 'forensic_reports_list' %}">Список проваджень</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item {% if request.GET.status == 'all' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=all">Усі
                    {% if request.GET.status == 'all' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if not request.GET.status %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}">Активні
                {% if not request.GET.status %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if request.GET.status == 'deactivate' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=deactivate">Призупинені
                    {% if request.GET.status == 'deactivate' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if request.GET.status == 'executed' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=executed">Закриті
                    {% if request.GET.status == 'executed' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
        </ul>
        <a class="btn btn-sm align-middle btn-outline-warning"
            id="add-report" href="{% url 'forensic_add_new_report' %}">Додати провадження</a>
    </div>
</nav>
{% endblock title %}

{% block extra_messages %}
{% if request.GET.filter_status == 'success' %}
<div class="alert alert-info"role="alert">
    <ul>Застосований фільтр:
    {% if request.GET.active == 'True' %}<li>тільки активні провадження</li>
    {% elif request.GET.active == 'False' %}<li>тільки призупинені провадження</li>{% endif %}
    {% if request.GET.date_from %}<li>провадження відкриті після {{ request.GET.date_from }}</li>{% endif %}
    {% if request.GET.date_until %}<li>провадження відкриті до {{ request.GET.date_until }}</li>{% endif %}
    {% if request.GET.day_count %}<li>у провадженні більше ніж {{ request.GET.day_count }}</li>{% endif %}
    </ul>
</div>
{% endif %}
{% endblock extra_messages %}

{% block content %}

{% if reports %}
{% with order_by=request.GET.order_by reverse=request.GET.reverse status=request.GET.status %}

<div class="card">
  <div class="card-body">
    {% if request.GET.status == 'all' %}
    Всього на виконанні - <strong>{{ content.open_reports }}</strong> проваджень, з них активних - <strong>{{ content.active_reports }}</strong>.
    Всього закрито - <strong>{{ content.closed_reports }}</strong> проваджень.
    {% elif not request.GET.status %}
    Всього активних проваджень - {{ content.reports_count }}
    {% elif request.GET.status == 'deactivate' %}
    Всього призупинених проваджень - {{ content.reports_count }}
    {% else %}
    Всього закритих проваджень - {{ content.reports_count }}
    {% endif %}
  </div>
</div>

<table class="table table-hover table-bordered">
    <thead>
        <tr>
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=number
{% if order_by == '' or reverse != '1' and order_by == 'number' %}&reverse=1{% endif %}">
                    № {% if order_by == '' or order_by == 'number' and reverse != '1' %}&uarr;
                    {% elif order_by == 'number' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            <th>Адреса</th>
            <th>Позивач</th>
            <th>Відповідач</th>
            <th>Тип Об'єкту</th>
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=research_kind">
                    Вид Дослідження {% if order_by == 'research_kind' %}&uarr;{% endif %}
                </a>
            </th>
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&
order_by=date_arrived{% if order_by == 'date_arrived' and reverse != '1' %}&reverse=1{% endif %}">
                    Дата надходження {% if order_by == 'date_arrived' and reverse != '1' %}&uarr;
                    {% elif order_by == 'date_arrived' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% if request.GET.status == 'executed' %}
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=date_executed
{% if order_by == 'date_executed' and reverse != '1' %}&reverse=1{% endif %}">
                    Дата виконання {% if order_by == 'date_executed' and reverse != '1' %}&uarr;
                    {% elif order_by == 'date_executed' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
            {% if not request.GET.status %}
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=active_days_amount
{% if order_by == 'active_days_amount' and reverse != '1' %}&reverse=1{% endif %}">
                    Днів у виконанні {% if order_by == 'active_days_amount' and reverse != '1' %}&uarr;
                    {% elif order_by == 'active_days_amount' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
            {% if request.GET.status == 'deactivate' %}
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=waiting_days_amount
{% if order_by == 'waiting_days_amount' and reverse != '1' %}&reverse=1{% endif %}">
                    Днів в очікуванні {% if order_by == 'waiting_days_amount' and reverse != '1' %}&uarr;
                    {% elif order_by == 'waiting_days_amount' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
            <th>Дії</th>
        </tr>
    </thead>

    <tbody>

        {% for report in reports %}
        <tr class="table-{% if report.active is None %}danger{% elif report.filled_info == False %}warning{% elif report.active %}success
            {% elif report.executed == False %}secondary{% else %}info{% endif %}"
            data-href="{% url 'report_details_list' report.id %}">
            <th scope="row">{{ report.full_number }}</td>
            <td class="td-link">{{ report.address }}</td>
            <td class="td-link">{{ report.plaintiff }}</td>
            <td class="td-link">{{ report.defendant }}</td>
            <td class="td-link">{{ report.object_name }}</td>
            <td class="td-link">{{ report.research_kind }}</td>
            <td class="td-link">{{ report.date_arrived }}</td>
            {% if request.GET.status == 'executed' %}
            <td class="td-link">{{ report.date_executed }}</td>
            {% endif %}
            {% if not request.GET.status %}
            <td class="td-link">
                {% if report.active_days_amount != 0 %}
                {{ report.active_days_amount|add:time_after_update }}
                {% else %}
                Відомості відсутні
                {% endif %}
            </td>
            {% else %}
            {% endif %}
            {% if request.GET.status == 'deactivate' %}
            <td class="td-link">
                {% if report.waiting_days_amount %}
                {{ report.waiting_days_amount|add:time_after_update }}
                {% else %}
                Відомості відсутні
                {% endif %}
            </td>
            {% endif %}
            <td>
                <div class="dropdown">
                    <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Дія
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="{% url 'report_details_list' report.id %}">Хід провадження</a>
                        {% if report.filled_info %}
                        <a class="dropdown-item" href="{% url 'forensic_edit_report' report.id %}">Редагувати</a>
                        {% endif %}
                        <a class="dropdown-item" href="{% url 'forensic_delete_report' report.id %}">Видалити</a>
                    </div>
                </div>
            </td>
        </tr>
        {% endfor %}


    </tbody>

</table>

{% endwith %}



{% else %}
<p>Ще немає даних</p>
{% endif %}

{% endblock content %}

{% block extra_content %}
{% if request.GET.executed != '1' %}
<div class="filter">
    <h4>Уточнити параметри</h4>
    <form class="form-horizontal" action="" method="get" enctype="multipart/form-data" role="form">
        <input type="hidden" name="filter_status" value="success" />
        <div class="form-group row">
            <label for="inputDateArrived" class="col-sm-12">Дата надходження</label>
            <div class="col-sm-4">від</div><input type="text" id="inputDateArrived"
                class="input-date col-sm-7 dateinput" name="date_from" value="{{ request.GET.date_from }}"/>
            <div class="col-sm-4">до</div><input type="text" class="input-date col-sm-7 dateinput" name="date_until"
                value="{{ request.GET.date_until }}"/>
        </div>
        <div class="form-group row">
            <label for="selectDayCount" class="col-sm-6">Днів у виконанні</label>
            <input type="number" class="col-sm-5" name="day_count" value="{{ request.GET.day_count }}"/>
        </div>
        <div class="form-group row" id="filter-button">
            <div class="col">
                <input type="submit" class="btn btn-info" value="Застосувати"
                    name="apply_button" />
                <input type="submit" class="btn btn-link" value="Скинути"
                    name="cancel_button" />
            </div>
        </div>

    </form>
</div>
{% endif %}
{% endblock extra_content %}
