{% extends "freports/base.html" %}

{% block title %}
<nav class="navbar navbar-expand-xl navbar-dark" style="background-color: #69a9ee;">
    <a class="navbar-brand" href="#">Список проваджень</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item {% if request.GET.executed != '1' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}">Відкриті
                    {% if request.GET.executed == '' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if request.GET.executed == '1' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?executed=1">Архівні
                    {% if request.GET.executed == '1' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
        </ul>
    </div>
</nav>
{% endblock title %}

{% block messages %}
{% if request.GET.filter_status == 'success' %}
<div class="alert alert-info"role="alert">
    <ul>Застосований фільтр:
    {% if request.GET.active == 'True' %}<li>тільки активні провадження</li>
    {% elif request.GET.active == 'False' %}<li>тільки призупинені провадження</li>{% endif %}
    {% if request.GET.date_from %}<li>провадження відкриті після {{ request.GET.date_from }}</li>{% endif %}
    {% if request.GET.date_until %}<li>провадження відкриті до {{ request.GET.date_until }}</li>{% endif %}
    {% if request.GET.day_count %}<li>у провадженні більше ніж {{ request.GET.day_count }}</li>{% endif %}
    </ul>
</div>
{% endif %}
{% endblock messages %}

{% block content %}

<a type="button" class="btn btn-success" id="add-button" href="{% url 'forensic_add_report' %}">Додати провадження</a>

{% if reports %}
{% with order_by=request.GET.order_by reverse=request.GET.reverse %}
<table class="table table-hover table-bordered">
    <thead>
        <tr>
            <th>
                <a href="{% url 'forensic_reports_list' %}?order_by=number{% if reverse != '1' and order_by == 'number' %}&reverse=1{% endif %}">
                    № {% if order_by == 'number' and reverse != '1' %}&uarr;
                    {% elif order_by == 'number' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            <th>Адреса</th>
            <th>Позивач</th>
            <th>Відповідач</th>
            <th>Тип Об'єкту</th>
            <th>
                <a href="{% url 'forensic_reports_list' %}?order_by=research_kind">
                    Вид Дослідження {% if order_by == 'research_kind' %}&uarr;{% endif %}
                </a>
            </th>
            <th>Дата надходження</th>
            {% if request.GET.executed == '1' %}
            <th>Дата виконання</th>
            {% endif %}
            <th>Днів у виконанні</th>
            <th>Дії</th>
        </tr>
    </thead>
{% endwith %}

    <tbody>

        {% for report in reports %}
        <tr class="table-{% if report.active %}success{% elif report.executed == False %}secondary{% else %}info{% endif %}">
            <th scope="row">{{ report.number }}/017</td>
            <td>{{ report.address }}</td>
            <td>{{ report.plaintiff }}</td>
            <td>{{ report.defendant }}</td>
            <td>{{ report.object_name }}</td>
            <td>{{ report.research_kind }}</td>
            <td>{{ report.date_arrived }}</td>
            {% if request.GET.executed == '1' %}
            <td>{{ report.date_executed }}</td>
            {% endif %}
            <td>{{ report.days_amount }}</td>
            <td>
                <div class="dropdown">
                    <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Дія
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="{% url 'report_details_list' report.id %}">Хід провадження</a>
                        <a class="dropdown-item" href="{% url 'forensic_edit_report' report.id %}">Редагувати</a>
                        <a class="dropdown-item" href="{% url 'forensic_delete_report' report.id %}">Видалити</a>
                    </div>
                </div>
            </td>
        </tr>
        {% endfor %}


    </tbody>

</table>

<div class="card">
  <div class="card-body">
    {% if request.GET.executed != '1' %}
    Всього в провадженні - {{ content.full_length }} експертиз, з них активних - {{ content.active_length }}
    {% else %}
    Всього закрито проваджень - {{ content.full_length }}
    {% endif %}
  </div>
</div>



{% else %}
<p>Ще немає даних</p>
{% endif %}

{% endblock content %}

{% block extra_content %}
{% if request.GET.executed != '1' %}
<div class="filter">
    <h4>Уточнити параметри</h4>
    <form class="form-horizontal" action="" method="get" enctype="multipart/form-data" role="form">
        <input type="hidden" name="filter_status" value="success" />
        <div class="form-group row">
            <label for="selectActive">Статус провадження</label>
            <select class="form-control" id="selectActive" name="active">
                <option value="">---------</option>
                <option value="True" {% if request.GET.active == 'True' %}selected{% endif %}>Активне</option>
                <option value="False" {% if request.GET.active == 'False' %}selected{% endif %}>Призупинене</option>
            </select>
        </div>
        <div class="form-group row">
            <label for="inputDateArrived" class="col-sm-12">Дата надходження</label>
            <div class="col-sm-4">від</div><input type="text" id="inputDateArrived"
                class="input-date col-sm-7 dateinput" name="date_from" value="{{ request.GET.date_from }}"/>
            <div class="col-sm-4">до</div><input type="text" class="input-date col-sm-7 dateinput" name="date_until"
                value="{{ request.GET.date_until }}"/>
        </div>
        <div class="form-group row">
            <label for="selectDayCount" class="col-sm-6">Днів у виконанні</label>
            <input type="number" class="col-sm-5" name="day_count" value="{{ request.GET.day_count }}"/>
        </div>
        <div class="form-group row" id="filter-button">
            <div class="col">
                <input type="submit" class="btn btn-info" value="Застосувати"
                    name="apply_button" />
                <input type="submit" class="btn btn-link" value="Скинути"
                    name="cancel_button" />
            </div>
        </div>
        
    </form>
</div>
{% endif %}
{% endblock extra_content %}
