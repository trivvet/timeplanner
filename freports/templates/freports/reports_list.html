{% extends "freports/base.html" %}

{% block title %}
<div class="col">
    <span class="h1">Список проваджень</span>
<!-- </div> -->
<!-- <div class="col-4"> -->
    <a class="btn btn-outline-info"
        id="add-report" href="{% url 'forensic_add_new_report' %}">Додати провадження</a>
</div>
{% endblock title %}

{% block extra_messages %}
{% if request.GET.filter_status == 'success' %}
<div class="alert alert-info"role="alert">
    <ul>Застосований фільтр:
    {% if request.GET.active == 'True' %}<li>тільки активні провадження</li>
    {% elif request.GET.active == 'False' %}<li>тільки призупинені провадження</li>{% endif %}
    {% if request.GET.date_from %}<li>провадження відкриті після {{ request.GET.date_from }}</li>{% endif %}
    {% if request.GET.date_until %}<li>провадження відкриті до {{ request.GET.date_until }}</li>{% endif %}
    {% if request.GET.day_count %}<li>у провадженні більше ніж {{ request.GET.day_count }}</li>{% endif %}
    </ul>
</div>
{% endif %}
{% endblock extra_messages %}

{% block content %}

<nav class="nav nav-pills nav-justified" id="navbar-list">
    <a class="nav-item nav-link {% if request.GET.status == 'all' %}active{% endif %}" href="{% url 'forensic_reports_list' %}?status=all">Усі <span class="badge badge-info">{{ content.open_reports }}</span></a>
    <a class=" nav-item nav-link {% if not request.GET.status %}active{% endif %}" href="{% url 'forensic_reports_list' %}">Активні <span class="badge badge-success">{{ content.active_reports }}</span></a>
    <a class="nav-link nav-item {% if request.GET.status == 'deactivate' %}active{% endif %}" href="{% url 'forensic_reports_list' %}?status=deactivate">Призупинені <span class="badge badge-secondary">{{ content.deactivate_reports }}</span></a>
    <a class="nav-link nav-item {% if request.GET.status == 'executed' %}active{% endif %}" href="{% url 'forensic_reports_list' %}?status=executed">Закриті <span class="badge badge-light">{{ content.closed_reports }}</span></a>
</nav>
<button class="btn btn-outline-secondary" id="filter-button" data-toggle="collapse" href="#filter" role="button" aria-expanded="false" aria-controls="collapseExample">Фільтр</button>
<div class="collapse" id="filter">
    <div class="card card-body">
        <div class="filter">
            <form class="form-inline row" action="" method="get" enctype="multipart/form-data" role="form">
                <input type="hidden" name="filter_status" value="success" />
                <div class="form-group mb-1 mt-1 col-9">
                    <label for="inputDateArrived">Дата надходження від</label>
                    <input type="text" id="inputDateArrived"
                        class="input-date dateinput form-control" name="date_from" value="{{ request.GET.date_from }}"/>
                    до<input type="text" class="input-date dateinput form-control" name="date_until"
                        value="{{ request.GET.date_until }}"/>
                    <label for="selectDayCount">Днів у виконанні</label>
                    <input class="input-date form-control" type="number" name="day_count" value="{{ request.GET.day_count }}"/>
                    
                </div>
                <div class="form-group mb-1 mt-1 col-3" id="filter-button">
                    <input type="submit" class="btn btn-outline-info" value="Застосувати"
                        name="apply_button" />
                    <input type="submit" class="btn btn-outline-secondary" value="Скинути"
                        name="cancel_button" />
                </div>
            </form>
        </div>
    </div>
</div>

<!-- <nav class="navbar navbar-expand-xl navbar-dark" style="background-color: #69a9ee;">
    <a class="navbar-brand" href="{% url 'forensic_reports_list' %}">Список проваджень</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item {% if request.GET.status == 'all' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=all">Усі
                    {% if request.GET.status == 'all' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if not request.GET.status %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}">Активні
                {% if not request.GET.status %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if request.GET.status == 'deactivate' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=deactivate">Призупинені
                    {% if request.GET.status == 'deactivate' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
            <li class="nav-item {% if request.GET.status == 'executed' %}active{% endif %}">
                <a class="nav-link" href="{% url 'forensic_reports_list' %}?status=executed">Закриті
                    {% if request.GET.status == 'executed' %}<span class="sr-only">(current)</span>{% endif %}</a>
            </li>
        </ul>
        
    </div>
</nav> -->

{% if reports %}
{% with order_by=request.GET.order_by reverse=request.GET.reverse status=request.GET.status %}

<!-- <div class="card">
  <div class="card-body">
    <span>{% if request.GET.status == 'all' %}
    Всього на виконанні - <strong>{{ content.open_reports }}</strong> проваджень.
    {% elif not request.GET.status %}
    Всього активних проваджень - <strong>{{ content.active_reports }}</strong>
    {% elif request.GET.status == 'deactivate' %}
    Всього призупинених проваджень - <strong>{{ content.deactivate_reports }}</strong>
    {% else %}
    Всього закритих проваджень - <strong>{{ content.closed_reports }}</strong>
    {% endif %}</span>
  </div>

</div> -->

<table class="table table-hover table-responsive-lg">
    <thead class="thead-light">
        <tr>
            <th scope="col">
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=number
{% if order_by == '' or reverse != '1' and order_by == 'number' %}&reverse=1{% endif %}">
                    № {% if order_by == '' or order_by == 'number' and reverse != '1' %}&uarr;
                    {% elif order_by == 'number' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            <th scope="col">Адреса</th>
            <th scope="col">Позивач</th>
            <th scope="col">Відповідач</th>
            <th scope="col">Тип Об'єкту</th>
            <th scope="col">
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=research_kind">
                    Вид Дослідження {% if order_by == 'research_kind' %}&uarr;{% endif %}
                </a>
            </th>
            <th scope="col">
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&
order_by=date_arrived{% if order_by == 'date_arrived' and reverse != '1' %}&reverse=1{% endif %}">
                    Дата надходження {% if order_by == 'date_arrived' and reverse != '1' %}&uarr;
                    {% elif order_by == 'date_arrived' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% if request.GET.status == 'executed' %}
            <th scope="col">
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=date_executed
{% if order_by == 'date_executed' and reverse != '1' %}&reverse=1{% endif %}">
                    Дата виконання {% if order_by == 'date_executed' and reverse != '1' %}&uarr;
                    {% elif order_by == 'date_executed' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
            {% if not request.GET.status %}
            <th scope="col">
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=active_days_amount
{% if order_by == 'active_days_amount' and reverse != '1' %}&reverse=1{% endif %}">
                    Днів у виконанні {% if order_by == 'active_days_amount' and reverse != '1' %}&uarr;
                    {% elif order_by == 'active_days_amount' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
            {% if request.GET.status == 'deactivate' %}
            <th>
                <a href="{% url 'forensic_reports_list' %}?status={{ status }}&order_by=waiting_days_amount
{% if order_by == 'waiting_days_amount' and reverse != '1' %}&reverse=1{% endif %}">
                    Днів в очікуванні {% if order_by == 'waiting_days_amount' and reverse != '1' %}&uarr;
                    {% elif order_by == 'waiting_days_amount' and reverse == '1' %}&darr;{% endif %}
                </a>
            </th>
            {% endif %}
        </tr>
    </thead>

    <tbody>

        {% for report in reports %}
        <tr class="{% if report.active is None %}table-danger{% endif %}"
            data-href="{% url 'report_details_list' report.id %}">
            <th class="td-link" scope="row"><p class="text-{% if report.executed == True %}info{% elif report.active == True %}success{% else %}secondary{% endif %}">{{ report.full_number }}</span></th>
            <td class="td-link">{{ report.address|truncatechars:25 }}</td>
            <td class="td-link">{{ report.plaintiff|truncatechars:20 }}</td>
            <td class="td-link">{{ report.defendant|truncatechars:20 }}</td>
            <td class="td-link">{{ report.object_name|truncatechars:20 }}</td>
            <td class="td-link">{{ report.research_kind|truncatechars:20 }}</td>
            <td class="td-link td-date">{{ report.date_arrived|truncatechars:10 }}</td>
            {% if request.GET.status == 'executed' %}
            <td class="td-link td-date">{{ report.date_executed|truncatechars:10 }}</td>
            {% endif %}
            {% if not request.GET.status %}
            <td class="td-link">
                {% if report.active_days_amount != 0 %}
                {{ report.active_days_amount|add:report.time_after_update }}
                {% else %}
                Відомості відсутні
                {% endif %}
            </td>
            {% endif %}
            {% if request.GET.status == 'deactivate' %}
            <td class="td-link">
                {% if report.waiting_days_amount %}
                {{ report.waiting_days_amount|add:report.time_after_update }}
                {% else %}
                Відомості відсутні
                {% endif %}
            </td>
            {% endif %}
        </tr>
        {% endfor %}


    </tbody>

</table>


{% endwith %}



{% else %}
<p>Ще немає даних</p>
{% endif %}

{% endblock content %}
